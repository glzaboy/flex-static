"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t(require("jquery")):t("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function(t){var e={escapeurl:function(t){var e={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};return t.replace(/&(lt|gt|nbsp|amp|quot);/gi,function(t,a){return e[a]})},geturlparam:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),a=location.search.substr(1).match(e);return null!=a?decodeURIComponent(a[2]):null},geturlparams:function(){for(var t={},e=null,a=decodeURIComponent(location.search.substring(1)),o=/(?:([^&]+)=([^&]+))/g;null!==(e=o.exec(a));)t[e[1]]=e[2];return t}};t.extend({escapeurl:e.escapeurl,geturlparam:e.geturlparam,geturlparams:e.geturlparams,replaceurlparams:function(a,o){var o=o||window.location.href.replace(/\?.{0,}/,""),n=window.location.search?window.location.search:"";t.each(a,function(t,a){console.log(t),console.log(a);var o=new RegExp("(^|&)"+t+"=[^&]*","i");n=e.geturlparam(t)?"?"+n.substr(1).replace(o,RegExp.$1+t+"="+a):n.match(/^\?/)&&n.length>1?n+"&"+t+"="+encodeURIComponent(a):"?"+t+"="+encodeURIComponent(a)}),window.location.href=o+n}}),t.extend({replaceurlparam:function(e,a,o){t.replaceurlparams(JSON.parse('{"'+e+'": "'+a+'"}'),o)}}),t.fn.extend({formErrorReset:function(){return t(this).each(function(e,a){var o=t(this).hasClass("form-inline");t(this).find(".alert").remove(),t(this).find(".form-group,.checkbox,.radio").each(function(e,a){o?(t(this).removeClass("has-error").find("input,textarea,select").each(function(){t(this).tooltip("destroy")}),t(this).tooltip("destroy")):t(this).hasClass("has-error")&&t(this).find(".help-block").data("orgtext")?t(this).removeClass("has-error").find(".help-block").html(t(this).find(".help-block").data("orgtext")):t(this).hasClass("has-error")&&t(this).removeClass("has-error").find(".help-block").remove()})}),t(this)},formFiledError:function(e){var a=t(this).parents(".form-group,.checkbox,.radio"),o="checkbox"==t(this).attr("type")||"radio"==t(this).attr("type"),n=t(this).parents("form").hasClass("form-inline");a.length?(a.addClass("has-error"),o&&!a.hasClass("checkbox")&&a.addClass("checkbox"),a.find(".help-block").length?(html=a.find(".help-block").html(),a.find(".help-block").data("orgtext",html).html(e)):n?window.setTimeout(function(){a.tooltip({container:"body",html:!0,placement:"top",title:e})},500):t(this).parent().append('<small class="help-block">'+e+"</small>")):t(this).parent("form").prepend('<div class="alert alert-danger"><button class="close" data-dismiss="alert"><i class="pci-cross pci-circle"></i></button>'+obj+"</div>")}}),t("body").on("req.ajax",".ajax",function(e){var a=t(this),o=a.attr("title");o||(o=a.text());var n=t(this).attr("href");if(console.log("url"+n),a.data("ajaxing"))return t.niftyNoty({type:"danger",message:"程序已经提交中了，请稍后片刻。",container:"floating",timer:5e3}),!1;a.data("ajaxing",!0),t.ajax({type:"GET",url:n,dataType:"json",data:{form:".ajax"}}).done(function(e){if(console.log(e),e.linkTextChange&&a.text(e.linkTextChange),e.autoJump&&window.setTimeout(function(){window.location.href=e.link?t.escapeurl(e.link):window.location.href},1e3*e.autoJump),e.autoHide&&("string"==typeof e.autoHide&&a.parents(e.autoHide).length?a.parents(e.autoHide).hide(1e3,function(){t(this).remove()}):a.hide(1e3,function(){t(this).remove()})),e.message){var o={};o.message=e.message,o.title="提示信息",o.buttons={},e.link&&e.link.length>0?o.buttons.ok={label:"确定",className:"btn-primary",callback:function(){window.location.href=e.link}}:o.buttons.ok={label:"确定",className:"btn-primary",callback:function(){}},t.dialog("remove"),t.dialog(o)}}).fail(function(e,a){t.niftyNoty({type:"danger",message:a,container:"floating",timer:5e3})}).always(function(t){a.data("ajaxing",!1)})}),t("body").on("click",".ajaxask,.ajax",function(e){e.preventDefault();var a=t(this);if(a.hasClass("ajax")||a.addClass("ajax"),a.hasClass("ajaxask")){var o=a.data("asktext")?a.data("asktext"):"您确定要"+a.text()+"?",n={};return n.message=o,n.title="提示信息",n.buttons={},n.buttons.ok={label:"确定",className:"btn-primary",callback:function(){a.trigger("req.ajax")}},n.buttons.cancel={label:"取消",className:"btn",callback:function(){}},t.dialog("remove"),t.dialog(n)}t(this).trigger("req.ajax")}),t("body").on("click",".ajaxdialog",function(e){e.preventDefault();var a=t(this),o=a.attr("title");o||(o=a.text());var n=a.attr("href"),r={};return r.url=n,r.title=o,r.buttons={},r.buttons.ok={label:"提交",className:"btn-primary",callback:function(e){var a=t(".jquerydialog").find("form");return a.length&&a.trigger("submit"),!1}},r.buttons.cancel={label:"取消",className:"btn",callback:function(){}},t.dialog(r)}),t("body").on("submit","form.ajaxform",function(e){e.preventDefault();var a=t(this);if(a.data("submiting"))return t.niftyNoty({type:"danger",message:"程序已经提交中了，请稍后片刻。",container:"floating",timer:5e3}),!1;a.data("submiting",1);var o={};if(o.url=a.attr("action")?a.attr("action"):window.location.href,o.type=a.attr("method")?a.attr("method"):"GET",o.data=a.serializeArray(),o.dataType="json","GET"==o.type.toUpperCase()){var n=t.param(o.data);o.url+=(o.url.indexOf("?")>=0?"&":"?")+n,o.data=null}a.formErrorReset(),t.ajax(o).done(function(e,o){if(console.log(e),e.message){var n={};n.message=e.message,n.title="提示信息",n.buttons={},e.link&&e.link.length>0?n.buttons.ok={label:"确定",className:"btn-primary",callback:function(){window.location.href=e.link}}:n.buttons.ok={label:"确定",className:"btn-primary",callback:function(){}},t.dialog("remove"),t.dialog(n)}e.autoJump&&window.setTimeout(function(){window.location.href=e.link?t.escapeurl(e.link):window.location.href},1e3*e.autoJump),e.error&&t.each(e.error,function(t,e){var o=a.find("input[name='"+t+"'],textarea[name='"+t+"'],select[name='"+t+"']"),n=o.parents(".form-group,.checkbox,.radio");o.length&&n.length?o.formFiledError(e):a.prepend('<div class="alert alert-danger"><button class="close" data-dismiss="alert"><i class="pci-cross pci-circle"></i></button>'+e+"</div>")})}).fail(function(e,a){t.niftyNoty({type:"danger",message:"提交数据出错，可能是服务器正在维护或是网络问题，请稍后再试。",container:"floating",timer:5e3})}).always(function(){a.data("submiting",0),console.log("complete")})})});